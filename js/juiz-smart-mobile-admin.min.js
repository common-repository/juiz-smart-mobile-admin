/*
Plugin Name: Juiz Smart Mobile Admin
Plugin URI: http://wp.creativejuiz.fr
Author: Geoffrey Crofte
*/
function Hammer(a,b,l){function g(e){e=e||window.event;if(H){for(var c=[],a=0<e.touches.length?e.touches:e.changedTouches,b=0,d=a.length;b<d;b++)e=a[b],c.push({x:e.pageX,y:e.pageY});return c}c=document;a=c.body;return[{x:e.pageX||e.clientX+(c&&c.scrollLeft||a&&a.scrollLeft||0)-(c&&c.clientLeft||a&&c.clientLeft||0),y:e.pageY||e.clientY+(c&&c.scrollTop||a&&a.scrollTop||0)-(c&&c.clientTop||a&&c.clientTop||0)}]}function h(e,a){if(2==e.length&&2==a.length){var b,d;b=e[0].x-e[1].x;d=e[0].y-e[1].y;var f= Math.sqrt(b*b+d*d);b=a[0].x-a[1].x;d=a[0].y-a[1].y;return Math.sqrt(b*b+d*d)/f}return 0}function I(a,c){if(2==a.length&&2==c.length){var b,d;b=a[0].x-a[1].x;d=a[0].y-a[1].y;var f=180*Math.atan2(d,b)/Math.PI;b=c[0].x-c[1].x;d=c[0].y-c[1].y;return 180*Math.atan2(d,b)/Math.PI-f}return 0}function k(a,c){c.touches=g(c.originalEvent);c.type=a;"[object Function]"==Object.prototype.toString.call(v["on"+a])&&v["on"+a].call(v,c)}function w(a){a=a||window.event;a.preventDefault?(a.preventDefault(),a.stopPropagation()): (a.returnValue=!1,a.cancelBubble=!0)}function E(e){switch(e.type){case "mousedown":case "touchstart":f=g(e);C=(new Date).getTime();t=!0;J=e;var c=a.getBoundingClientRect();x=c.top+(window.pageYOffset||a.scrollTop||document.body.scrollTop)-(a.clientTop||document.body.clientTop||0);y=c.left+(window.pageXOffset||a.scrollLeft||document.body.scrollLeft)-(a.clientLeft||document.body.clientLeft||0);D=!0;z.hold(e);b.prevent_default&&w(e);break;case "mousemove":case "touchmove":if(!D)return!1;d=g(e);z.transform(e)|| z.drag(e);break;case "mouseup":case "mouseout":case "touchcancel":case "touchend":if(!D||"transform"!=j&&e.touches&&0<e.touches.length)return!1;D=!1;c="drag"==j;z.swipe(e);c?k("dragend",{originalEvent:e,direction:r,distance:m,angle:p}):"transform"==j?k("transformend",{originalEvent:e,position:A,scale:h(f,d),rotation:I(f,d)}):z.tap(J);K=j;k("release",{originalEvent:e,gesture:j});A=d=f=void 0;t=!1;p=m=0;j=null}}function F(a,c,b){c=c.split(" ");for(var d=0,f=c.length;d<f;d++)a.addEventListener?a.addEventListener(c[d], b,!1):document.attachEvent&&a.attachEvent("on"+c[d],b)}var x,y,f,d,A,v=this;var s={prevent_default:!1,css_hacks:!0,swipe:!0,swipe_time:200,swipe_min_distance:20,drag:!0,drag_vertical:!0,drag_horizontal:!0,drag_min_distance:20,transform:!0,scale_treshold:0.1,rotation_treshold:15,tap:!0,tap_double:!0,tap_max_interval:300,tap_max_distance:10,tap_double_distance:20,hold:!0,hold_timeout:500},u=b,q={};if(u){for(var n in s)q[n]=n in u?u[n]:s[n];b=q}else b=s;if(b.css_hacks){s=["webkit","moz","ms","o",""]; u={userSelect:"none",touchCallout:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"};q="";for(n=0;n<s.length;n++)for(var L in u)q=L,s[n]&&(q=s[n]+q.substring(0,1).toUpperCase()+q.substring(1)),a.style[q]=u[L]}var m=0,p=0,r=0;A=d=f=void 0;var t=!1,j=null,K=null,C=null,B={x:0,y:0},G=null,M=null;y=x=void 0;var D=!1,J,H="ontouchstart"in window;this.option=function(a,c){c!=l&&(b[a]=c);return b[a]};this.getDirectionFromAngle=function(a){a={down:45<=a&&135>a,left:135<=a||-135>=a,up:-45>a&&-135<a, right:-45<=a&&45>=a};var c,b;for(b in a)if(a[b]){c=b;break}return c};var z={hold:function(a){b.hold&&(j="hold",clearTimeout(M),M=setTimeout(function(){"hold"==j&&k("hold",{originalEvent:a,position:f})},b.hold_timeout))},swipe:function(a){if(d){var c=d[0].x-f[0].x,h=d[0].y-f[0].y;m=Math.sqrt(c*c+h*h);var g=(new Date).getTime()-C;b.swipe&&b.swipe_time>g&&m>b.swipe_min_distance&&(p=180*Math.atan2(d[0].y-f[0].y,d[0].x-f[0].x)/Math.PI,r=v.getDirectionFromAngle(p),j="swipe",k("swipe",{originalEvent:a,position:{x:d[0].x- y,y:d[0].y-x},direction:r,distance:m,distanceX:c,distanceY:h,angle:p}))}},drag:function(a){var c=d[0].x-f[0].x,h=d[0].y-f[0].y;m=Math.sqrt(c*c+h*h);if(b.drag&&m>b.drag_min_distance||"drag"==j){p=180*Math.atan2(d[0].y-f[0].y,d[0].x-f[0].x)/Math.PI;r=v.getDirectionFromAngle(p);var g="up"==r||"down"==r;(g&&!b.drag_vertical||!g&&!b.drag_horizontal)&&m>b.drag_min_distance||(j="drag",c={originalEvent:a,position:{x:d[0].x-y,y:d[0].y-x},direction:r,distance:m,distanceX:c,distanceY:h,angle:p},t&&(k("dragstart", c),t=!1),k("drag",c),w(a))}},transform:function(a){if(b.transform){if(2!=(a.touches?a.touches.length:1))return!1;var c=I(f,d),g=h(f,d);if("drag"!=j&&("transform"==j||Math.abs(1-g)>b.scale_treshold||Math.abs(c)>b.rotation_treshold))return j="transform",A={x:(d[0].x+d[1].x)/2-y,y:(d[0].y+d[1].y)/2-x},c={originalEvent:a,position:A,scale:g,rotation:c},t&&(k("transformstart",c),t=!1),k("transform",c),w(a),!0}return!1},tap:function(a){var c=(new Date).getTime(),h=c-C;if(!b.hold||b.hold&&b.hold_timeout> h){if(B&&b.tap_double&&"tap"==K&&C-G<b.tap_max_interval)var h=Math.abs(B[0].x-f[0].x),g=Math.abs(B[0].y-f[0].y),h=B&&f&&Math.max(h,g)<b.tap_double_distance;else h=!1;h?(j="double_tap",G=null,k("doubletap",{originalEvent:a,position:f}),w(a)):(h=d?Math.abs(d[0].x-f[0].x):0,g=d?Math.abs(d[0].y-f[0].y):0,m=Math.max(h,g),m<b.tap_max_distance&&(j="tap",G=c,B=f,b.tap&&(k("tap",{originalEvent:a,position:f}),w(a))))}}};H?F(a,"touchstart touchmove touchend touchcancel",E):(F(a,"mouseup mousedown mousemove", E),F(a,"mouseout",function(b){var c;a:if(c=b.relatedTarget,!c&&window.event&&window.event.toElement&&(c=window.event.toElement),a===c)c=!0;else{if(c)for(c=c.parentNode;null!==c;){if(c===a){c=!0;break a}c=c.parentNode}c=!1}c||E(b)}))} (function(a){a.each("hold tap doubletap transformstart transform transformend dragstart drag dragend swipe release".split(" "),function(b,l){a.event.special[l]={setup:function(b){var h=a(this);h.hammer||h.data("hammerjs",new Hammer(this,b));h.data("hammerjs")["on"+l]=function(b){h.trigger(a.Event(l,b))}},teardown:function(){var b=a(this).data("hammerjs");b&&b["on"+l]&&delete b["on"+l]}}})})(jQuery); jQuery(document).ready(function(a){if(800>a(window).width()){var b=function(b,g){var k="html";a.browser.webkit&&(k="body");a(k).animate({scrollTop:b.offset().top},500,g||!1)};a(".row-actions span, .row-actions-visible span").each(function(){var b=a(this).find("a");a(this).html(b)});a(".column-date br").replaceWith(" - ");a(".response-links .post-com-count-wrapper br").replaceWith(" ");a(".column-tags").each(function(){var b=a(this).html(),b=b.replace(RegExp(",","gi")," ");a(this).html(b)});a("#adminmenushadow").after('<div id="adminmenushadow_left"></div>'); a("#wpcontent").append('<a href="#adminmenu" class="juiz_goto_menu">Menu</a>');a(".juiz_goto_menu").live("click",function(){b(a("#adminmenu"));return!1});a(".juiz_goto_header").css("display","block").live("click",function(){b(a("#wpcontent"))});document.location.href.match(".php")&&b(a("#wpcontent"));if(1==a("body.edit-tags-php").length||1==a("body.nav-menus-php").length)a("body.edit-tags-php").find(".icon32").next("h2").after('<a class="juiz_goto_tag add_and_go_to_bottom" href="#addtag"><em lang="en">Add</em> / <em lang="fr">Ajouter</em></a>'), a("body.nav-menus-php").find(".icon32").next("h2").after('<a class="juiz_goto_menus add_and_go_to_bottom" href="#menu-management-liquid"><em lang="en">Add</em> / <em lang="fr">Ajouter</em></a>'),a(".juiz_goto_tag").live("click",function(){b(a("#addtag"),function(){a("#tag-name").focus()});return!1}),a(".juiz_goto_menu").live("click",function(){b(a("#menu-management-liquid"),function(){a("#menu-name").focus()});return!1});a(".galerie_page_nggallery-add-gallery").find("#disable_flash").trigger("click"); a("body.media-new-php").find(".upload-flash-bypass > a").trigger("click");/iPhone/i.test(navigator.userAgent)&&!location.hash&&setTimeout(function(){pageYOffset||window.scrollTo(0,1)},1E3);if(0<a("#wpadminbar").length&&0==a(".branch-3-3, .branch-3-4, .branch-3-5").length){var l=a("#wpadminbar"),g=l.find(".quicklinks>ul");l.find("#adminbarsearch");l=a("#wpadminbar .avatar").attr("src");output_ab='<form id="juiz_admin_bar" action="#">';output_ab+='<label for="juiz_goto"><img src="'+l+'" alt="Action :" width="16" height="16" /></label>'; output_ab+='<select name="juiz_goto" id="juiz_goto">';a(g).children("li").each(function(){var b=a(this).children("a").attr("href"),g=a(this).children("a").text();0<a(this).find("li").length?(output_ab+='<optgroup label="'+g+'">',a(this).find("li").each(function(){var b=a(this).children("a").attr("href"),h=a(this).children("a").text();output_ab+='<option value="'+b+'">'+h+"</option>"}),output_ab+="</optgroup>"):output_ab+='<option value="'+b+'">&gt;&gt; '+g+"</option>"});output_ab+="</select>";output_ab+= '<input type="submit" class="adminbar-button" value="Go" />';output_ab+="</form>";a("#wpadminbar .quicklinks ul").remove();a("#wpadminbar .quicklinks").append(output_ab);a("#juiz_admin_bar").submit(function(){var b=a("#juiz_admin_bar option:selected").val();window.location.href=b;return!1})}else 0<a("#wpadminbar").length&&0<a(".branch-3-3, .branch-3-4, .branch-3-5").length&&(console.log("test"),a("#wpadminbar").insertBefore("#wpwrap"));a(".wp-submenu-wrap li, .wp-submenu-wrap li a, li.wp-has-submenu, li.wp-has-submenu a").unbind("release, tap, mouseenter, mouseleave, mousehover"); a(".wp-submenu-wrap li, .wp-submenu-wrap li a, li.wp-has-submenu, li.wp-has-submenu a").off("release, tap, mouseenter, mouseleave, mousehover");a(".wp-submenu-wrap li, .wp-submenu-wrap li a, li.wp-has-submenu, li.wp-has-submenu a").die("release, tap, mouseenter, mouseleave, mousehover");g=a("#adminmenu");a('li.menu-top:not(".wp-has-submenu")',g).on("tap",function(b){b.stopPropagation();window.location.href=a(this).children.attr(href);return!1});a("li.wp-has-submenu>a",g).on("swipe",function(){return!1}); a("a.thickbox").each(function(){var b=a(this).attr("href"),g=a(this).text();a(this).after('<a class="juiz_sma_thickbox" target="_blank" href="'+b+'">'+g+"</a>").remove()})}});